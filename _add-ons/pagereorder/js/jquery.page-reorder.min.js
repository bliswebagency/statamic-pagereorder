/* 
 * HTML5 Sortable jQuery Plugin
 * http://farhadi.ir/projects/html5sortable
 * 
 * Copyright 2012, Ali Farhadi
 * @license: Released under the MIT license.
 */
(function(e){var t,r=e();e.fn.sortable=function(n){var a=n+"";return n=e.extend({connectWith:!1},n),this.each(function(){if(/^enable|disable|destroy$/.test(a)){var s=e(this).children(e(this).data("items")).attr("draggable","enable"==a);return"destroy"==a&&s.add(this).removeData("connectWith items").off("dragstart.h5s dragend.h5s selectstart.h5s dragover.h5s dragenter.h5s drop.h5s"),void 0}var i,d,s=e(this).children(n.items),o=e("<"+(/^ul|ol$/i.test(this.tagName)?"li":"div")+' class="sortable-placeholder">');s.find(n.handle).mousedown(function(){i=!0}).mouseup(function(){i=!1}),e(this).data("items",n.items),r=r.add(o),n.connectWith&&e(n.connectWith).add(this).data("connectWith",n.connectWith),s.attr("draggable","true").on("dragstart.h5s",function(r){if(n.handle&&!i)return!1;i=!1;var a=r.originalEvent.dataTransfer;a.effectAllowed="move",a.setData("Text","dummy"),d=(t=e(this)).addClass("sortable-dragging").index()}).on("dragend.h5s",function(){t&&(t.removeClass("sortable-dragging").show(),r.detach(),d!=t.index()&&t.parent().trigger("sortupdate",{item:t}),t=null)}).not("a[href], img").on("selectstart.h5s",function(){return this.dragDrop&&this.dragDrop(),!1}).end().add([this,o]).on("dragover.h5s dragenter.h5s drop.h5s",function(a){return s.is(t)||n.connectWith===e(t).parent().data("connectWith")?"drop"==a.type?(a.stopPropagation(),r.filter(":visible").after(t),t.trigger("dragend.h5s"),!1):(a.preventDefault(),a.originalEvent.dataTransfer.dropEffect="move",s.is(this)?(n.forcePlaceholderSize&&o.height(t.outerHeight()),t.hide(),e(this)[o.index()<e(this).index()?"after":"before"](o),r.not(o).detach()):r.is(this)||e(this).children(n.items).length||(r.detach(),e(this).append(o)),!1):!0})})}})(jQuery),/*
Author:   Jannis Gundermann
Twitter:  @jannisg
Web:      http://jannisgundermann.com/

          Copyright 2013, Jannis Gundermann
@license: Released under the MIT license.
*/
function(){$(function(){var e,t,r,n,a,s,i,d,o,l,c,h,u,g;return(d="draggable"in document.createElement("span"))?(i={success:_.template('<div id="flash-msg" class="success">\n  <span class="icon">8</span>\n  <span class="msg"><%= message %></p>\n</div>'),error:_.template('<div id="flash-msg" class="error">\n  <span class="icon">c</span>\n  <span class="msg"><%= message %></p>\n</div>')},e=$("#status-bar"),e.on("flash",function(t,r){var n,a,s;return a=50,$("#flash-msg").length&&(a=150,n=$("#flash-msg"),n.stop(!0).fadeOut(a,function(){return n.remove()})),s=i[r.status]({message:r.message}),e.prepend(s),$("#flash-msg").delay(a).animate({"margin-top":"0"},900,"easeOutBounce").delay(3e3).animate({"margin-top":"-74px"},900,"easeInOutBack",function(){return $(this).remove()}),void 0}),n=$("#page-tree"),r=n.find(".subpages"),h="page-order",a=""+h+"-active",l=""+h+"-ignore",s=""+h+"-sortable",o='<div class="'+h+'">\n  <div class="'+h+'__block">\n    <div class="'+h+'__icon">&#11021;</div>\n  </div>\n</div>',n.children().each(function(){var e,t,r;return e=$(this),t=$.trim(e.find(".slug-preview").first().text()),"/"===t?e.addClass(l):(e.addClass(s),null!=(r=e.find("> .page-wrapper"))?r.prepend(o):void 0)}),g="",t=null,(c=function(){return t=$("#page-tree").sortable({items:"."+s,handle:"."+h+"__block"})})(),u=function(){return n.html(g),t.sortable("destroy"),c()},t.on({dragstart:function(){return n.addClass(a),r.slideUp({duration:350,easing:"easeInExpo"}),g=n.html()},dragend:function(){return n.removeClass(a),r.slideDown({duration:700,easing:"easeOutExpo"})},sortupdate:function(){var t,r,a,s,i,d;return i=$(this).find("> .page"),r=function(){var e,r,n;for(n=[],e=0,r=i.length;r>e;e++)s=i[e],t=$(s),n.push({index:t.index(),url:$.trim(t.find(".slug-preview").first().text())});return n}(),a=JSON.stringify(r),d="/TRIGGER/pagereorder/reorder",$.ajax(d,{type:"POST",data:{order:a},complete:function(t){var r,a,s,i,d,o,l,c,h;if(t.responseText&&(d=$.parseJSON(t.responseText)),e.triggerHandler("flash",d),"success"===d.status&&null!=d.linkage)for(i=d.linkage,o=0,c=i.length;c>o;o++)if(s=i[o],s.old!==s["new"])for(a=n.find("a[href*='"+s.old+"']"),l=0,h=a.length;h>l;l++)r=a[l],r.href=r.href.replace(""+s.old,""+s["new"]);return"error"===d.status?u():void 0},error:function(){return e.triggerHandler("flash",{status:"error",message:"There was an error saving your page order. Please try again."}),u()}}),void 0}})):!1})}.call(this);