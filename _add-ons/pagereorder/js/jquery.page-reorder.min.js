/* 
 * HTML5 Sortable jQuery Plugin
 * http://farhadi.ir/projects/html5sortable
 * 
 * Copyright 2012, Ali Farhadi
 * @license: Released under the MIT license.
 */
(function(e){var t,a=e();e.fn.sortable=function(r){var n=r+"";return r=e.extend({connectWith:!1},r),this.each(function(){if(/^enable|disable|destroy$/.test(n)){var s=e(this).children(e(this).data("items")).attr("draggable","enable"==n);return"destroy"==n&&s.add(this).removeData("connectWith items").off("dragstart.h5s dragend.h5s selectstart.h5s dragover.h5s dragenter.h5s drop.h5s"),void 0}var i,d,s=e(this).children(r.items),o=e("<"+(/^ul|ol$/i.test(this.tagName)?"li":"div")+' class="sortable-placeholder">');s.find(r.handle).mousedown(function(){i=!0}).mouseup(function(){i=!1}),e(this).data("items",r.items),a=a.add(o),r.connectWith&&e(r.connectWith).add(this).data("connectWith",r.connectWith),s.attr("draggable","true").on("dragstart.h5s",function(a){if(r.handle&&!i)return!1;i=!1;var n=a.originalEvent.dataTransfer;n.effectAllowed="move",n.setData("Text","dummy"),d=(t=e(this)).addClass("sortable-dragging").index()}).on("dragend.h5s",function(){t&&(t.removeClass("sortable-dragging").show(),a.detach(),d!=t.index()&&t.parent().trigger("sortupdate",{item:t}),t=null)}).not("a[href], img").on("selectstart.h5s",function(){return this.dragDrop&&this.dragDrop(),!1}).end().add([this,o]).on("dragover.h5s dragenter.h5s drop.h5s",function(n){return s.is(t)||r.connectWith===e(t).parent().data("connectWith")?"drop"==n.type?(n.stopPropagation(),a.filter(":visible").after(t),t.trigger("dragend.h5s"),!1):(n.preventDefault(),n.originalEvent.dataTransfer.dropEffect="move",s.is(this)?(r.forcePlaceholderSize&&o.height(t.outerHeight()),t.hide(),e(this)[o.index()<e(this).index()?"after":"before"](o),a.not(o).detach()):a.is(this)||e(this).children(r.items).length||(a.detach(),e(this).append(o)),!1):!0})})}})(jQuery),/*
Author:   Jannis Gundermann
Twitter:  @jannisg
Web:      http://jannisgundermann.com/

          Copyright 2013, Jannis Gundermann
@license: Released under the MIT license.
*/
function(){$(function(){var e,t,a,r,n,s,i,d,o,l,c;return(d="draggable"in document.createElement("span"))?(i={success:_.template('<div id="flash-msg" class="success">\n  <span class="icon">8</span>\n  <span class="msg"><%= message %></p>\n</div>'),error:_.template('<div id="flash-msg" class="error">\n  <span class="icon">c</span>\n  <span class="msg"><%= message %></p>\n</div>')},e=$("#status-bar"),e.on("flash",function(t,a){var r,n,s;return n=50,$("#flash-msg").length&&(n=150,r=$("#flash-msg"),r.stop(!0).fadeOut(n,function(){return r.remove()})),s=i[a.status]({message:a.message}),e.prepend(s),$("#flash-msg").delay(n).animate({"margin-top":"0"},900,"easeOutBounce").delay(3e3).animate({"margin-top":"-74px"},900,"easeInOutBack",function(){return $(this).remove()}),void 0}),r=$("#page-tree"),a=r.find(".subpages"),c="page-order",n=""+c+"-active",l=""+c+"-ignore",s=""+c+"-sortable",o='<div class="'+c+'">\n  <div class="'+c+'__block">\n    <div class="'+c+'__icon">&#11021;</div>\n  </div>\n</div>',r.children().each(function(){var e,t,a;return e=$(this),t=$.trim(e.find(".slug-preview").first().text()),"/"===t?e.addClass(l):(e.addClass(s),null!=(a=e.find("> .page-wrapper"))?a.prepend(o):void 0)}),t=$("#page-tree").sortable({items:"."+s,handle:"."+c+"__block"}),t.on({dragstart:function(){return r.addClass(n),a.slideUp({duration:350,easing:"easeInExpo"})},dragend:function(){return r.removeClass(n),a.slideDown({duration:700,easing:"easeOutExpo"})},sortupdate:function(){var t,a,r,n,s,i;return s=$(this).find("> .page"),a=function(){var e,a,r;for(r=[],e=0,a=s.length;a>e;e++)n=s[e],t=$(n),r.push({index:t.index(),url:$.trim(t.find(".slug-preview").first().text())});return r}(),r=JSON.stringify(a),i="/TRIGGER/pagereorder/reorder",$.ajax(i,{type:"POST",data:{order:r},complete:function(t){var a;return t.responseText&&(a=$.parseJSON(t.responseText)),e.triggerHandler("flash",a)},error:function(){return e.triggerHandler("flash",{status:"error",message:"There was an error saving your page order. Please try again."})}}),void 0}})):!1})}.call(this);